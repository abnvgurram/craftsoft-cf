<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Craft Soft</title>
    <meta name="description" content="Craft Soft Admin Dashboard">
    <meta name="robots" content="noindex, nofollow">

    <!-- Security: No Cache -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="../favicon.svg">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Admin Styles -->
    <link rel="stylesheet" href="css/admin.css">
</head>

<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="dashboard-header-left">
                <span class="dashboard-logo">Craft Soft</span>
                <span class="dashboard-title">Admin Panel</span>
            </div>
            <div class="dashboard-header-right">
                <div class="admin-badge" id="admin-badge">
                    <i class="fa-solid fa-shield-halved"></i>
                    <span id="admin-id">Loading...</span>
                </div>

                <!-- Logout Dropdown -->
                <div class="logout-dropdown" id="logout-dropdown">
                    <button class="btn-logout-trigger" id="logout-trigger">
                        <i class="fa-solid fa-right-from-bracket"></i>
                        <span>Logout</span>
                        <i class="fa-solid fa-chevron-down dropdown-arrow"></i>
                    </button>
                    <div class="logout-menu" id="logout-menu">
                        <button class="logout-option" id="logout-current">
                            <i class="fa-solid fa-user-minus"></i>
                            <span>Logout</span>
                        </button>
                        <button class="logout-option logout-all" id="logout-all">
                            <i class="fa-solid fa-users-slash"></i>
                            <span>Logout from All Devices</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="dashboard-main">
            <div class="dashboard-placeholder">
                <div class="dashboard-placeholder-icon">
                    <i class="fa-solid fa-code"></i>
                </div>
                <h2>Dashboard Under Development</h2>
                <p>We're building something amazing. This section will be expanded with admin features progressively.
                </p>
            </div>
        </main>

        <!-- Footer -->
        <footer class="dashboard-footer">
            Â© 2024 Craft Soft. All rights reserved.
        </footer>
    </div>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/admin-utils.js"></script>
    <script src="js/auth.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const { Toast, Modal, NavigationSecurity } = window.AdminUtils;

            // Initialize navigation security (back/forward protection)
            NavigationSecurity.initProtectedPage();

            // Check authentication
            const session = await window.supabaseConfig.getSession();

            if (!session) {
                NavigationSecurity.secureRedirect('/admin/login.html');
                return;
            }

            // Get admin details
            const admin = await window.Auth.getCurrentAdmin();

            if (!admin || admin.status !== 'ACTIVE') {
                Toast.error('Access Denied', 'Your account is not active');
                await NavigationSecurity.secureLogout();
                return;
            }

            // Display admin info
            document.getElementById('admin-id').textContent = admin.admin_id || 'Admin';

            // Logout dropdown toggle
            const logoutTrigger = document.getElementById('logout-trigger');
            const logoutMenu = document.getElementById('logout-menu');
            const logoutDropdown = document.getElementById('logout-dropdown');

            logoutTrigger.addEventListener('click', (e) => {
                e.stopPropagation();
                logoutDropdown.classList.toggle('open');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!logoutDropdown.contains(e.target)) {
                    logoutDropdown.classList.remove('open');
                }
            });

            // Individual Logout
            document.getElementById('logout-current').addEventListener('click', () => {
                logoutDropdown.classList.remove('open');
                Modal.confirm(
                    'Confirm Logout',
                    'Are you sure you want to logout from this device?',
                    async () => {
                        Toast.info('Logging out...', '');
                        await NavigationSecurity.secureLogout();
                    }
                );
            });

            // Logout from All Devices
            document.getElementById('logout-all').addEventListener('click', () => {
                logoutDropdown.classList.remove('open');
                Modal.confirm(
                    'Logout from All Devices',
                    'This will log you out from ALL devices and sessions. Continue?',
                    async () => {
                        Toast.info('Logging out from all devices...', '');
                        await NavigationSecurity.secureLogoutAll();
                    }
                );
            });

            // Listen for auth state changes
            window.supabaseConfig.onAuthStateChange((event, session) => {
                if (event === 'SIGNED_OUT') {
                    NavigationSecurity.secureRedirect('/admin/login.html');
                }
            });
        });
    </script>
</body>

</html>